# RIK Prooviülesanne

**Autor:** Eduard Teller

## Ülevaade

Külaliste registreerimissüsteem, mis võimaldab hallata üritusi ja nende osavõtjaid:

- **Ürituste haldus**: Lisa, muuda ja kustuta tulevikus toimuvaid üritusi
- **Ajalugu**: Vaata juba toimunud üritusi
- **Osavõtjad**: Halda eraisikuid ja juriidilisi isikuid (ettevõtteid)
- **Külaliste nimekiri**: Vaata täielikku nimekirja iga ürituse kohta

## Süsteemi ülesehitus

**NB!** Süsteemi kood (frontend ja backend) on põhjalikult kommenteeritud eesti keeles – kõik komponendid, funktsioonid ja äriloogika on selgelt dokumenteeritud. Alljärgnev on vaid üldine ülevaade.

### Frontend

**React** veebirakendus, mis kasutab modernset tehnoloogiapunti ja komponentide arhitektuuri:

- **Leheküljed** - Neli peamist vaadet (`Avaleht`, `LisaYritus`, `Osavotjad`, `OsavotjadDetail`)
- **Komponendid** - Korduvkasutatavad elemendid (`Header`, `Footer`, `EventItem`)
- **API kihid** - Andmevahetuse loogika (`events.ts`, `participants.ts`)
- **Skeemid** - Zod validatsiooniskeemid vormide andmete kontrolliks
- **Marsruutimine** - React Router põhine navigatsioon lehekülgede vahel

### Backend

**Java Spring Boot** rakendus, mis järgib klassikalist kolmekihilist arhitektuuri:

- **Controllers** - REST API endpointide haldamine (`YritusedController`, `IsikudController`)
- **Services** - Äriloogika implementeerimine (`YritusedService`, `IsikudService`)
- **Repositories** - Andmebaasi juurdepääs JPA/Hibernate kaudu
- **Models** - JPA entiteedid andmebaasi tabelite kirjeldamiseks
- **DTOs** - Andmete ülekandemudel, mis lisab kalkuleeritud väljad (nt osalejate arv)

### Andmebaas

Andmebaas on PostgreSQL, mis on hostitud Neon pilves. Andmebaasi struktuur koosneb järgmistest tabelitest:

- **maksmise_viisid**: Sisaldab kõiki võimalikke maksmise viise (sularaha, pangaülekanne)
- **yritused**: Hoiustab ürituste andmeid (nimi, aeg, koht, lisainfo)
- **fyysilised_isikud**: Sisaldab eraisikute andmeid (eesnimi, perekonnanimi, isikukood, maksmise viis, lisainfo)
- **juriidilised_isikud**: Hoiustab ettevõtete andmeid (nimi, registrikood, osavõtjate arv, maksmise viis, lisainfo)
- **yritused_isikud**: Seosetabel, mis ühendab üritused nende osavõtjatega (nii füüsilised kui juriidilised isikud)

![Andmebaasi skeem](https://i.imgur.com/eYNFmpt.png 'Andmebaasi skeem')
_Andmebaasi skeem: https://i.imgur.com/eYNFmpt.png_

## Kasutatud raamistikud ja tööriistad

### Frontend

- **React** koos **Vite** bundleriga
- **React Router** - navigeerimine
- **React Query** - andmete haldus
- **Tailwind CSS** - stiilid
- **React Hook Form** - vormide haldus
- **Zod** - validatsioon

### Backend

- **Java Spring Boot**
- **JPA** - andmebaasi ORM

## Testimine

- **Frontend**: Vitest + jsdom + Testing Library
- **Backend**: JUnit

## Nõuded

- **JDK 24**
- **Node.js 20.18.0+**

## Käivitamine

### 1. Backend

1. Ava kaust `prooviylesanne-backend` IntelliJ IDEA-s
2. Veendu, et Gradle on kõik vajalikud sõltuvused alla laadinud
3. Käivita rakendus "Run" nupuga

Backend testid saab käivitada IntelliJ IDEA-st

### 2. Frontend

#### Samm-sammult juhend:

1. **Navigeeri projekti kausta:**

   ```bash
   cd prooviylesanne-frontend
   ```

2. **Installi sõltuvused:**

   ```bash
   npm install
   ```

   _See käsk laeb alla kõik `package.json` failis määratud sõltuvused. Esimene kord võib võtta mõned minutid._

3. **Käivita arendusserver:**

   ```bash
   npm run dev
   ```

   _Vite arendusserver käivitub ja näitab terminalis täpse aadressi (tavaliselt `http://localhost:5173`)._

Frontend testide käivitamiseks kasuta `npm test`

## Lisa

### Kasutatud SQL andmebaasi struktuuri loomisel

```sql

CREATE TABLE maksmise_viisid (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
maksmise_viis VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE yritused (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
nimi VARCHAR(255) NOT NULL,
aeg TIMESTAMP WITH TIME ZONE NOT NULL,
koht VARCHAR(255) NOT NULL,
lisainfo VARCHAR(1000)
);

CREATE TABLE fyysilised_isikud (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
eesnimi VARCHAR(255) NOT NULL,
perekonnanimi VARCHAR(255) NOT NULL,
isikukood VARCHAR(11) NOT NULL,
maksmise_viis VARCHAR(255) NOT NULL,
lisainfo VARCHAR(1500) NOT NULL,
FOREIGN KEY (maksmise_viis) REFERENCES maksmise_viisid(maksmise_viis)
);

CREATE TABLE juriidilised_isikud (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
nimi VARCHAR(255) NOT NULL,
registrikood VARCHAR(8) NOT NULL,
osavotjate_arv VARCHAR(11) NOT NULL,
maksmise_viis VARCHAR(255) NOT NULL,
lisainfo VARCHAR(5000) NOT NULL,
FOREIGN KEY (maksmise_viis) REFERENCES maksmise_viisid(maksmise_viis)
);

CREATE TABLE yritused_isikud (
id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
yrituse_id BIGINT NOT NULL,
juriidiline_isik_id BIGINT,
fyysiline_isik_id BIGINT,
FOREIGN KEY (yrituse_id) REFERENCES yritused(id),
FOREIGN KEY (juriidiline_isik_id) REFERENCES juriidilised_isikud(id),
FOREIGN KEY (fyysiline_isik_id) REFERENCES fyysilised_isikud(id),
CONSTRAINT chk_exclusive_isik CHECK ((juriidiline_isik_id IS NULL AND fyysiline_isik_id IS NOT NULL) OR (juriidiline_isik_id IS NOT NULL AND fyysiline_isik_id IS NULL))
);

INSERT INTO maksmise_viisid (maksmise_viis) VALUES ('sularaha');
INSERT INTO maksmise_viisid (maksmise_viis) VALUES ('pangaülekanne');

```
